# XGDataTools Copilot Instructions

## Project Overview

XGDataTools is a Ruby toolkit for working with eXtreme Gammon (XG) file formats used in backgammon analysis software.

## Domain Context

- **eXtreme Gammon**: Professional backgammon analysis software
- **XG files**: Binary format with game data, positions, analysis, and rollouts
- **File format**: Complex nested binary structures with ZLib compression
- **Endianness**: Little-endian byte order throughout

## Architecture

- The xg File format is documented in XGFile_format.txt

### Core Modules

- **`xgutils.rb`**: CRC32, date conversion, UTF16 string handling
- **`xgimport.rb`**: File segmentation and stream processing  
- **`xgstruct.rb`**: Hash-based record classes with binary deserialization
- **`xgzarc.rb`**: ZLib archive handling
- **`extractxgdata.rb`**: CLI application for data extraction

### Ruby Style
- Use modules for namespacing
- Snake_case naming conventions
- Explicit binary mode for file I/O

### Testing
- Use TDD, write tests first
- **Minitest framework** for all tests
- Use test helpers for common operations
- Ensure 100% test coverage for statements and branches

```ruby
class TestXGUtils < Minitest::Test
  def test_method_with_valid_input
    result = XGUtils.method(valid_input)
    assert_equal expected_result, result
  end
  
  def test_method_with_error
    assert_raises(StandardError) do
      XGUtils.method(invalid_input)
    end
  end
end
```

### Dependencies
- **Standard library only** (no external gems)
- Exception: SimpleCov for test coverage
- Exception: standardrb for code formatting
- Core libraries: `zlib`, `date`, `tempfile`, `fileutils`

## Key Considerations

- **Binary data**: Always use little-endian format (`<`) in pack/unpack
- **Stream processing**: Handle large files efficiently 
- **Hash inheritance**: Support both `obj['key']` and `obj.key` syntax
- **Error handling**: Provide meaningful context with filenames
- **Memory efficiency**: Use streaming for large file operations
